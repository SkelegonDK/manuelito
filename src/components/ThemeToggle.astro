---
import { FaSun, FaMoon } from "react-icons/fa6";
---

<button id="themeToggle" class="p-2 rounded-lg text-black dark:text-white transition-all duration-300 relative h-8 w-8">
  <span class="sun-icon absolute inset-0 flex items-center justify-center text-black transition-all duration-300">
    <FaSun size={20} />
  </span>
  <span class="moon-icon absolute inset-0 flex items-center justify-center text-white transition-all duration-300">
    <FaMoon size={20} />
  </span>
</button>

<style>
  #themeToggle {
    background: none;
    position: relative;
    overflow: hidden;
  }
  .sun-icon, .moon-icon {
    transition: all 0.3s ease;
  }
  
  /* Animation for icon transitions */
  :global(html.dark) .sun-icon {
    transform: translateY(100%) rotate(50deg);
    opacity: 0;
  }
  
  :global(html:not(.dark)) .moon-icon {
    transform: translateY(-100%) rotate(-50deg);
    opacity: 0;
  }
  
  :global(html.dark) .moon-icon {
    transform: translateY(0) rotate(0);
    opacity: 1;
  }
  
  :global(html:not(.dark)) .sun-icon {
    transform: translateY(0) rotate(0);
    opacity: 1;
  }
  
  :global(.sun-icon svg) {
    fill: currentColor;
    color: #000000;
    transition: transform 0.3s ease;
  }
  
  :global(.moon-icon svg) {
    fill: currentColor;
    color: #ffffff;
    transition: transform 0.3s ease;
  }
</style>

<script>
  document.addEventListener('astro:page-load', () => {
    const theme = (() => {
      if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
        return localStorage.getItem('theme');
      }
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark';
      }
      return 'light';
    })();
        
    if (theme === 'light') {
      document.documentElement.classList.remove('dark');
    } else {
      document.documentElement.classList.add('dark');
    }

    if (theme) {
      window.localStorage.setItem('theme', theme);
    }

    const handleToggleClick = () => {
      const element = document.documentElement;
      element.classList.toggle("dark");

      const isDark = element.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    };

    const toggleButton = document.getElementById("themeToggle");
    if (toggleButton) {
      toggleButton.addEventListener("click", handleToggleClick);
    }
  });
</script>
